{"version":3,"file":"main.js","mappings":"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","sources":["webpack://typescriptnodetemplate/external commonjs \"throng\"","webpack://typescriptnodetemplate/external commonjs \"bunyan\"","webpack://typescriptnodetemplate/./src/config/config.ts","webpack://typescriptnodetemplate/external commonjs \"compression\"","webpack://typescriptnodetemplate/external commonjs \"express\"","webpack://typescriptnodetemplate/external commonjs \"helmet\"","webpack://typescriptnodetemplate/external commonjs \"swagger-ui-express\"","webpack://typescriptnodetemplate/external commonjs \"morgan\"","webpack://typescriptnodetemplate/external commonjs \"cors\"","webpack://typescriptnodetemplate/./src/server/routes/Route.ts","webpack://typescriptnodetemplate/external node-commonjs \"http\"","webpack://typescriptnodetemplate/./src/server/ExpressAPP.ts","webpack://typescriptnodetemplate/./src/index.ts","webpack://typescriptnodetemplate/./src/server/routes/facebookRoute.ts","webpack://typescriptnodetemplate/external commonjs \"dotenv\"","webpack://typescriptnodetemplate/webpack/bootstrap","webpack://typescriptnodetemplate/webpack/runtime/compat get default export","webpack://typescriptnodetemplate/webpack/runtime/define property getters","webpack://typescriptnodetemplate/webpack/runtime/hasOwnProperty shorthand","webpack://typescriptnodetemplate/webpack/startup"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = require(\"throng\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"bunyan\");","// eslint-disable-next-line @typescript-eslint/no-var-requires\r\nrequire('dotenv').config();\r\n\r\nimport bunyan from 'bunyan';\r\nimport pjs from '../../package.json';\r\n\r\n// * Obtiene el json package\r\nconst { version } = pjs;\r\n\r\n// * Crea un logger\r\nconst getLogger = (serviceName: string, serviceVersion: string) => \r\nbunyan.createLogger({ name: `${serviceName}:${serviceVersion}` });\r\n\r\n/**\r\n * * Configuraci贸n segun env \r\n */\r\nconst config = {\r\n\tdevelopment: {\r\n        estado: 'development',\r\n        port: parseInt(process.env.PORT_DEV),\r\n        verify_fb: process.env.VERIFY_TOKEN,\r\n        log: (): bunyan => getLogger('DEVELOPMENT', version),\r\n\t},\r\n\r\n\tproduction: {\r\n        estado: 'production',\r\n        port: parseInt(process.env.PORT_DEV),\r\n        verify_fb: process.env.VERIFY_TOKEN,\r\n        log: (): bunyan => getLogger('PRODUCCION', version),\r\n\t},\r\n\r\n    test: {\r\n        estado: 'test',\r\n        verify_fb: process.env.VERIFY_TOKEN,\r\n        port: 1,\r\n        log: (): bunyan => getLogger('TEST', version),\r\n    },\r\n};\r\n\r\n/**\r\n * Adquiere una configuraci贸n segun el tipo de env\r\n * @param env \r\n * @returns \r\n */\r\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\r\nexport const getConfig = (env: string) => {\r\n    switch (env) {\r\n        case 'development':\r\n            return config.development;\r\n        case 'production':\r\n            return config.production;\r\n        case 'test':\r\n            return config.test;                    \r\n        default:\r\n            break;\r\n    }\r\n    return null;\r\n}\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"compression\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"express\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"helmet\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"swagger-ui-express\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"morgan\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"cors\");","import { Router } from 'express';\r\n/**\r\n * Usa r.router para adquirir el router y r.ruta para adquirir la ruta\r\n *  \r\n * @class Route\r\n */\r\nclass Route {\r\n    protected _router: Router;\r\n    protected _ruta: string;\r\n\r\n    constructor(ruta: string, router: Router) {\r\n        this._router = router;\r\n        this._ruta = ruta[0] === '/' ? ruta : '/' + ruta;\r\n    }\r\n    \r\n    /**\r\n     * Adquiere la ruta con el formato /ruta\r\n     *\r\n     * @readonly\r\n     * @type {string}\r\n     * @memberof Route\r\n     */\r\n    public get ruta() : string {\r\n        return this._ruta;\r\n    }\r\n\r\n    /**\r\n     * Adquiere el router de tipo express.Router\r\n     *\r\n     * @readonly\r\n     * @type {Router}\r\n     * @memberof Route\r\n     */\r\n    public get router() : Router {\r\n        return this._router;\r\n    }\r\n}\r\n\r\nexport default Route;","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"http\");","import compression from 'compression';\r\nimport express from 'express';\r\nimport helmet from 'helmet';\r\nimport swaggerUI from 'swagger-ui-express';\r\nimport swaggerDoc from '../documentation/swaggerDocument.json';\r\nimport morgan from 'morgan';\r\nimport cors from 'cors';\r\nimport {crearRutaFB} from './routes/facebookRoute';\r\nimport { IExpressNecesaryFunctions, IExpressNecesaryParams } from '../lib/ExpressNecesary';\r\nimport http from 'http';\r\n\r\n/**\r\n *\r\n *\r\n * @class ExpressAPP\r\n * Clase para crear y manejar la aplicaci贸n de express\r\n */\r\nclass ExpressAPP implements IExpressNecesaryFunctions, IExpressNecesaryParams {\r\n    app: express.Application;\r\n    server: http.Server;\r\n    /**\r\n     *Creates an instance of ExpressAPP.\r\n     * @memberof ExpressAPP\r\n     */\r\n    constructor(port: number) {\r\n        this.app = express();\r\n        this.agregarConfiguracionBasica();\r\n        this.agregarRutas();\r\n        this.agregarDocumentacion();\r\n        this.crearServidor(port)\r\n    }\r\n\r\n    /**\r\n     * Agrega la configuraci贸n basica necesaria para el optimo y correcto funcionamiento de la app\r\n     *\r\n     * @memberof ExpressAPP\r\n     */\r\n    agregarConfiguracionBasica(): void {\r\n        this.app.use(helmet());\r\n        this.app.use(compression());\r\n        this.app.use(cors());\r\n        this.app.use(morgan(':method :url'));\r\n        this.app.use(express.json());\r\n        this.app.use(express.urlencoded({ extended: true }));\r\n    }\r\n    \r\n    /**\r\n     * Usando Swagger agrega la documentation base\r\n     * Es importante tener '../documentation/swaggerDocument'\r\n     * \r\n     * @memberof ExpressAPP\r\n     */\r\n    agregarDocumentacion(): void {\r\n        this.app.use('/api-docs', swaggerUI.serve, swaggerUI.setup(swaggerDoc));\r\n        // * Redirije / a la documentacion\r\n        this.app.get('/', (req, res) => {\r\n          res.redirect('/api-docs');\r\n        });\r\n    }\r\n\r\n    /**\r\n     * En esta funcion agrega las rutas\r\n     *\r\n     * @memberof ExpressAPP\r\n     */\r\n    agregarRutas(): void {\r\n        const fbRoute = crearRutaFB();\r\n        this.app.use(fbRoute.ruta, fbRoute.router);\r\n    }\r\n\r\n    /**\r\n     * Crear el servidor dado un port, usa el module http\r\n     *\r\n     * @param {number} port\r\n     * @returns\r\n     * @memberof ExpressAPP\r\n     */\r\n    crearServidor(port: number): void {\r\n        this.server = http.createServer(this.app);\r\n        this.server.listen(port);\r\n    }\r\n}\r\n\r\nexport default ExpressAPP;","import throng from 'throng';\r\nimport { getConfig } from './config/config';\r\nimport ExpressAPP from './server/ExpressAPP';\r\n\r\nconst WORKERS = (process.env.WEB_CONCURRENCY || 1) as number;\r\n\r\nconst configENV = getConfig(process.env.NODE_ENV);\r\n\r\nconst PORT = configENV.port || 2000;\r\n\r\nconst start = (id: number) => {\r\n    configENV.log().info(`Id Worker ${id}`);\r\n    const serverApp = new ExpressAPP(PORT);\r\n    const server = serverApp.server;\r\n\r\n    server.on('listening', () => {\r\n        configENV.log().info('http://localhost:' + PORT);\r\n    });\r\n  \r\n    server.on('close', () => {\r\n        configENV.log().info('Servidor cerrado');\r\n    }) \r\n};\r\n\r\nthrong({ worker: start, count: WORKERS });","import { Router } from 'express';\r\nimport Route from './Route';\r\nimport { IFacebookWebHook } from '../../lib/FacebookInterfaces';\r\nimport { getConfig } from '../../config/config';\r\n\r\n// ** Crea una ruta\r\nexport const crearRutaFB = (): Route => {\r\n\r\n    const rutaNombre = 'fb';\r\n    const router = Router();\r\n\r\n    // *Agregar las rutas get, post aqui\r\n    \r\n    router.get('/', (req, res) => {\r\n        return res.json({message: `Ruta /${rutaNombre} funciona`});\r\n    });\r\n\r\n    router.post('/webhook', (req, res) => {\r\n        try {\r\n            const body = req.body as IFacebookWebHook;\r\n            if (body.object === 'page') {\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                body.entry.forEach((entry) => {\r\n                    const webhook_event = entry.messaging[0];\r\n                    console.log(webhook_event);\r\n                });\r\n                return res.status(200).send('EVENT_RECEIVED');\r\n              } else {\r\n                return res.status(404).json({error: 'El evento no es de una pagina de subscripcion'});\r\n              }\r\n        } catch (error) {\r\n            return res.status(500).json({error: error.message});\r\n        }\r\n    });\r\n\r\n    router.get('/webhook', (req, res) => {\r\n            const VERIFY_TOKEN = getConfig(process.env.NODE_ENV).verify_fb;\r\n            const mode = req.query['hub.mode'];\r\n            const token = req.query['hub.verify_token'];\r\n            const challenge = req.query['hub.challenge'];\r\n        \r\n            if (mode && token) {\r\n              if (mode === 'subscribe' && token === VERIFY_TOKEN) {\r\n\r\n                console.log('WEBHOOK_VERIFIED');\r\n                return res.status(200).send({message: 'Verificacion exitosa', challenge});\r\n            \r\n              } else {\r\n                return res.status(403).json({error: 'Verificacion fallida'});    \r\n              }\r\n            } \r\n  });\r\n\r\n    const rutaEjemplo = new Route(rutaNombre, router);\r\n\r\n    return rutaEjemplo;\r\n};\r\n","module.exports = require(\"dotenv\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// startup\n// Load entry module and return exports\n// This entry module doesn't tell about it's top-level declarations so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(787);\n"],"names":["require","version","getLogger","serviceName","serviceVersion","name","config","development","estado","port","parseInt","process","env","PORT_DEV","verify_fb","VERIFY_TOKEN","log","production","test","getConfig","WORKERS","WEB_CONCURRENCY","configENV","PORT","worker","id","info","server","constructor","this","app","agregarConfiguracionBasica","agregarRutas","agregarDocumentacion","crearServidor","use","extended","get","req","res","redirect","fbRoute","router","Router","json","message","post","body","object","entry","forEach","webhook_event","messaging","console","status","send","error","mode","query","token","challenge","ruta","_router","_ruta","crearRutaFB","listen","on","count","module","exports","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","obj","prop","prototype","hasOwnProperty","call"],"sourceRoot":""}