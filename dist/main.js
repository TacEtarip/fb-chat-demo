(()=>{"use strict";var e={947:(e,t,r)=>{const s=require("throng");var o=r.n(s);const n=require("bunyan");var a=r.n(n);const i=JSON.parse('{"name":"chatbotexample","version":"0.0.1","description":"Template para usar TypeScript con nodejs","main":"./dist/main.js","scripts":{"test":"cross-env NODE_ENV=test jest --verbose --silent --collectCoverage","test:watch":"npm test -- --watch","start":"cross-env NODE_ENV=production node ./dist/main.js | bunyan","dev:start":"cross-env NODE_ENV=development npx ts-node-dev ./src/index.ts | bunyan","build":"cross-env NODE_ENV=production webpack --config webpack.prod.js"},"keywords":["template","node","typescript"],"author":"TacEtarip","license":"ISC","dependencies":{"bunyan":"^1.8.15","compression":"^1.7.4","cors":"^2.8.5","cross-env":"^7.0.3","dotenv":"^10.0.0","express":"^4.17.1","helmet":"^4.6.0","morgan":"^1.10.0","swagger-ui-express":"^4.1.6","throng":"^5.0.0"},"devDependencies":{"@types/bunyan":"^1.8.7","@types/compression":"^1.7.2","@types/cors":"^2.8.12","@types/express":"^4.17.13","@types/jest":"^27.0.1","@types/morgan":"^1.9.3","@types/supertest":"^2.0.11","@types/swagger-ui-express":"^4.1.3","@types/throng":"^5.0.2","@typescript-eslint/eslint-plugin":"^4.31.1","@typescript-eslint/parser":"^4.31.1","eslint":"^7.32.0","eslint-config-google":"^0.14.0","eslint-plugin-import":"^2.24.2","eslint-plugin-jest":"^24.4.2","eslint-plugin-node":"^11.1.0","jest":"^27.2.0","supertest":"^6.1.6","ts-jest":"^27.0.5","ts-loader":"^9.2.5","ts-node":"^10.2.1","ts-node-dev":"^1.1.8","tslib":"^2.3.1","typescript":"^4.4.3","webpack":"^5.53.0","webpack-cli":"^4.8.0","webpack-merge":"^5.8.0","webpack-node-externals":"^3.0.0"},"engines":{"node":"14.16.x"},"jest":{"moduleNameMapper":{"\\\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$":"<rootDir>/__mocks__/fileMock.js"}}}');r(142).config();const{version:c}=i,p=(e,t)=>a().createLogger({name:`${e}:${t}`}),u={development:{estado:"development",port:parseInt(process.env.PORT),verify_fb:process.env.VERIFY_TOKEN,log:()=>p("DEVELOPMENT",c)},production:{estado:"production",port:parseInt(process.env.PORT),verify_fb:process.env.VERIFY_TOKEN,log:()=>p("PRODUCCION",c)},test:{estado:"test",verify_fb:process.env.VERIFY_TOKEN,port:1,log:()=>p("TEST",c)}},l=e=>{switch(e){case"development":return u.development;case"production":return u.production;case"test":return u.test}return null},d=require("compression");var g=r.n(d);const v=require("express");var h=r.n(v);const m=require("helmet");var E=r.n(m);const b=require("swagger-ui-express");var f=r.n(b);const y=JSON.parse('{"openapi":"3.0.2","info":{"license":{"name":"MIT","url":"https://github.com/TacEtarip/loscreadores/blob/main/LICENSE"},"contact":{"email":"hu3rtas@outlook.com","name":"Luis Huertas"},"title":"Chat demo","version":"0.0.1","description":"Demo para chat"},"servers":[{"url":"http://localhost:8081"}],"paths":{}}'),T=require("morgan");var w=r.n(T);const _=require("cors");var O=r.n(_);const j=require("http");var N=r.n(j);var k;!function(e){e.GET="GET",e.POST="POST",e.DELETE="DELETE",e.UPDATE="UPDATE"}(k||(k={}));const x=class extends class{}{constructor(e){super(),this._router=(0,v.Router)(),this._ruta="/"===e[0]?e:"/"+e}get ruta(){return this._ruta}get router(){return this._router}};class R{constructor(e){this.ruta=e,this.verificacionTokenWebhook=(e,t)=>{const r=e.query["hub.mode"],s=e.query["hub.verify_token"],o=e.query["hub.challenge"];return r&&s&&"subscribe"===r&&s===this.VERIFY_TOKEN?t.status(200).send(o):t.status(403).json({error:"Verificacion fallida"})},this.recivirWebHook=(e,t)=>{try{const r=e.body;return"page"===r.object?(r.entry.forEach((e=>{const t=e.messaging[0];console.log(t)})),t.status(200).send("EVENT_RECEIVED")):t.status(404).json({error:"El evento no es de una pagina de subscripcion"})}catch(e){return t.status(500).json({error:e.message})}},this.ruta=e,this.VERIFY_TOKEN=l("production").verify_fb}}const D=e=>{const t=new class{constructor(e){this.rutas=["/api-docs"],this.app=h()(),this.port=e,this.agregarConfiguracionBasica(),this.agregarDocumentacion()}agregarConfiguracionBasica(){this.app.use(E()()),this.app.use(g()()),this.app.use(O()()),this.app.use(w()(":method :url")),this.app.use(h().json()),this.app.use(h().urlencoded({extended:!0}))}agregarDocumentacion(){this.app.use("/api-docs",f().serve,f().setup(y)),this.app.get("/",((e,t)=>{t.redirect("/api-docs")}))}agregarRuta(e){this.rutas.push(e.ruta),this.app.use(e.ruta,e.router)}crearServidor(){return this.server=N().createServer(this.app),this.server.listen(this.port),this.server}}(e),r=(()=>{const e=new x("/example");return e.router.get("/",((e,t)=>t.json({message:"Ruta /example funciona"}))),e})();t.agregarRuta(r);const s=(()=>{const e=new x("/fb"),t=new R("/fb");return e.router.get("/",((e,t)=>t.json({message:"Ruta /fb funciona"}))),e.router.post("/webhook",t.recivirWebHook),e.router.get("/webhook",t.verificacionTokenWebhook),e})();return t.agregarRuta(s),t.crearServidor(),t},I=process.env.WEB_CONCURRENCY||1,q=l("production"),V=parseInt(process.env.PORT);o()({worker:e=>{q.log().info(`Id Worker ${e}`);const t=D(V).server;t.on("listening",(()=>{q.log().info("http://localhost:"+V)})),t.on("close",(()=>{q.log().info("Servidor cerrado")}))},count:I})},142:e=>{e.exports=require("dotenv")}},t={};function r(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(947)})();
//# sourceMappingURL=main.js.map